<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    
</body>
<script>
     
    // 职责链模式的定义是：使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间
    // 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。

    // 现实中的职责链模式
    //     职责链模式的例子在现实中并不难找到，以下就是两个常见的跟职责链模式有关的场景。
    //      如果早高峰能顺利挤上公交车的话，那么估计这一天都会过得很开心。因为公交车上人
    //     实在太多了，经常上车后却找不到售票员在哪，所以只好把两块钱硬币往前面递。除非
    //     你运气够好，站在你前面的第一个人就是售票员，否则，你的硬币通常要在N 个人手上
    //     传递，才能最终到达售票员的手里。
    //      中学时代的期末考试，如果你平时不太老实，考试时就会被安排在第一个位置。遇到不
    //     会答的题目，就把题目编号写在小纸条上往后传递，坐在后面的同学如果也不会答，他
    //     就会把这张小纸条继续递给他后面的人。

    // 从这两个例子中，我们很容易找到职责链模式的最大优点：请求发送者只需要知道链中的第
    // 一个节点，从而弱化了发送者和一组接收者之间的强联系。如果不使用职责链模式，那么在公交
    // 车上，我就得先搞清楚谁是售票员，才能把硬币递给他。同样，在期末考试中，也许我就要先了
    // 解同学中有哪些可以解答这道题。

    // 实际开发中的职责链模式
    // 假设我们负责一个售卖手机的电商网站，经过分别交纳500 元定金和200 元定金的两轮预定
    // 后（订单已在此时生成），现在已经到了正式购买的阶段。
    // 公司针对支付过定金的用户有一定的优惠政策。在正式购买后，已经支付过500 元定金的用
    // 户会收到100 元的商城优惠券，200 元定金的用户可以收到50 元的优惠券，而之前没有支付定金
    // 的用户只能进入普通购买模式，也就是没有优惠券，且在库存有限的情况下不一定保证能买到。
    // 我们的订单页面是PHP 吐出的模板，在页面加载之初，PHP 会传递给页面几个字段。
    //  orderType：表示订单类型（定金用户或者普通购买用户），code 的值为1 的时候是500 元
    // 定金用户，为2 的时候是200 元定金用户，为3 的时候是普通购买用户。
    //  pay：表示用户是否已经支付定金，值为true 或者false, 虽然用户已经下过500 元定金的
    // 订单，但如果他一直没有支付定金，现在只能降级进入普通购买模式。
    //  stock：表示当前用于普通购买的手机库存数量，已经支付过500 元或者200 元定金的用
    // 户不受此限制。
    // 下面我们把这个流程写成代码：


        var order = function ( orderType , pay , stock ) {

            if( orderType == 1 ) {// 500元订购模式

                if( pay === true ) {// 已支付定金

                    console.log( '500定金预购 ， 得到100优惠券' );
                
                } else {// 未支付定金 ， 降级到普通购买模式

                    if( stock > 0 ) {

                        console.log( '普通购买 , 无优惠券' );

                    } else {

                        console.log( '手机库存不足' );

                    }

                }

            } 

            else if ( orderType === 2 ){// 200元订购模式

                if ( pay === true ) {

                    console.log( '200元定金预购 , 得到50元优惠券' )

                } else {

                    if ( stock > 0 ) {

                        console.log( '普通购买 ， 无优惠券' );

                    } else {

                        console.log( '手机库存不足' );

                    }

                }

            } 

            else if ( orderType === 3 ){

                if ( stock > 0 ) {

                    console.log( '普通购买 , 无优惠券' );

                } else {

                    console.log( '手机库存不足' );

                }

            }

        };

        order( 1 , true , 500 );//500定金预购 ， 得到100优惠券



</script>
</html>